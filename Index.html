<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin: 10px; font-family: sans-serif; }
    .grid { display: grid; grid-template-columns: repeat(3,45px); grid-auto-rows:45px; gap:4px; justify-content:center;}
    .cell { display:flex; align-items:center; justify-content:center; border:1px solid #444; font-size:14px; cursor:pointer; user-select:none; color:white;}
    .item0{ grid-column:1/span 3; background-color:green!important; color:white!important;}
    .selected{ background:#cef!important; border-color:#69f!important;}
    .results-wrapper{display:flex; justify-content:center; gap:10px; margin-top:10px; flex-wrap: wrap;}
    .result-box{width:60px; height:45px; display:flex; align-items:center; justify-content:center; border:2px solid #444; font-size:16px; background:#eee;}
    .result-red { background:#fdd; color:red; font-weight:bold; border-color:red; }
    .live-numbers{margin-top:20px; text-align:center; font-size:18px; font-weight:bold;}
  </style>
</head>
<body>
  <div class="grid" id="buttonGrid"></div>
  <div class="results-wrapper" id="results"></div>
  <div class="live-numbers" id="liveNumbers">Loading live numbers...</div>

  <script>
    const colorMap = [
      'green','red','black','red','black','red','black','red','black','red',
      'black','black','red','black','red','black','red','black','red','red',
      'black','red','black','red','black','red','black','red','black','red',
      'black','red','black','red','black','red','black'
    ];

    // Your custom order list
    const orderList = [
      0,26,3,35,12,28,7,29,18,22,9,31,14,20,1,33,16,24,5,10,23,8,30,11,
      36,13,27,6,34,17,25,2,21,4,19,15,32
    ];

    const gridEl = document.getElementById('buttonGrid');
    const resultsEl = document.getElementById('results');
    const liveEl = document.getElementById('liveNumbers');

    let selectedNumber = null;

    function getMaxInSameRow(num) {
      if (num === 0) return 0; // 0 is special
      const rowIndex = Math.floor((num - 1) / 3);
      const start = rowIndex * 3 + 1;
      const end = start + 2;
      let max = start;
      for (let i = start; i <= end; i++) {
        if (i <= 36 && i > max) max = i;
      }
      return max;
    }

    function getAboveBelow(num) {
      const idx = orderList.indexOf(num);
      if (idx === -1) return { above: null, below: null };

      const aboveIdx = (idx - 1 + orderList.length) % orderList.length;
      const belowIdx = (idx + 1) % orderList.length;

      return { above: orderList[aboveIdx], below: orderList[belowIdx] };
    }

    function updateResults() {
      resultsEl.innerHTML = '';

      if (selectedNumber !== null) {
        const maxInRow = getMaxInSameRow(selectedNumber);
        const calc1 = selectedNumber - 7; // old 3rd value
        const calc2 = maxInRow - 9;       // old 4th value (first number)
        const calc3 = (calc1 + calc2 - selectedNumber)*-1-2; // your earlier logic

        // Above/below values from orderList
        const { above, below } = getAboveBelow(selectedNumber);

        // Show calc2, calc3, above, below
        const values = [calc2, calc3, above, below];

        values.forEach(val => {
          const box = document.createElement('div');
          box.className = 'result-box';
          box.textContent = val !== null ? val : '-';
          resultsEl.appendChild(box);
        });

        // New final number = first number + (last number) / 2)
        if (calc2 !== null && below !== null) {
          const finalNo = calc2 + below/ 2;
          const redBox = document.createElement('div');
          redBox.className = 'result-box result-red';
          redBox.textContent = finalNo;
          resultsEl.appendChild(redBox);
        }
      }
    }

    async function fetchLiveNumbers() {
      try {
        const resp = await fetch('https://cors-anywhere.com/https://casinoscores.com/red-door-roulette/');
        const html = await resp.text();
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const spins = doc.querySelectorAll('.spin-history .spin-number');
        const nums = Array.from(spins).slice(0, 1).map(e => parseInt(e.textContent.trim()));
        liveEl.textContent = 'Live Number: ' + nums[0];

        if (!isNaN(nums[0])) {
          updateSelections(nums[0]);
        }
      } catch (e) {
        liveEl.textContent = 'Unable to fetch live numbers';
        console.error(e);
      }
    }

    function updateSelections(num) {
      selectedNumber = num;
      document.querySelectorAll('.cell').forEach(el => el.classList.remove('selected'));

      const btn = document.querySelector(`.cell[data-number="${num}"]`);
      if (btn) {
        btn.classList.add('selected');
      }

      updateResults();
    }

    // Build the number grid
    for (let i = 0; i <= 36; i++) {
      const div = document.createElement('div');
      div.textContent = i;
      div.className = 'cell' + (i === 0 ? ' item0' : '');
      div.style.backgroundColor = colorMap[i];
      div.setAttribute('data-number', i);
      div.addEventListener('click', () => {
        if (selectedNumber === i) {
          selectedNumber = null;
          div.classList.remove('selected');
        } else {
          selectedNumber = i;
          document.querySelectorAll('.cell').forEach(el => el.classList.remove('selected'));
          div.classList.add('selected');
        }
        updateResults();
      });
      gridEl.appendChild(div);
    }

    // Fetch live numbers every 30s
    setInterval(fetchLiveNumbers, 30000);
    fetchLiveNumbers();
  </script>
</body>
</html>
